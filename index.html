<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í¬ìŠ¤íŠ¸ì‡ ë²½</title>

<style>
/* ===== ì „ì²´ ë°°ê²½ (ì½”ë¥´í¬) ===== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-image: url("images/cork.jpg");
  background-repeat: repeat;
  background-size: 400px 400px;
}

/* ì œëª© */
h1 {
  margin: 0;
  padding: 16px;
  text-align: center;
  background: rgba(255,255,255,0.3);
  position: sticky;
  top: 0;
  z-index: 5;
}

/* ì½”ë¥´í¬ íŒ */
#board {
  position: relative;
  min-height: 100vh;
  padding: 40px;
  box-sizing: border-box;
}

/* ===== í¬ìŠ¤íŠ¸ì‡ ===== */
.postit {
  position: absolute;
  width: 220px;
  min-height: 220px;
  padding: 14px;
  box-sizing: border-box;

  background-color: #fff59d;
  background-image: url("images/paper.png");
  background-size: cover;
  background-repeat: no-repeat;
  background-blend-mode: multiply;

  box-shadow:
    2px 4px 6px rgba(0,0,0,0.25),
    inset 0 0 8px rgba(255,255,255,0.3);

  white-space: pre-wrap;
  word-break: break-word;
}

/* í…Œì´í”„ */
.postit::before {
  content: "";
  position: absolute;
  top: -12px;
  left: 50%;
  width: 60px;
  height: 24px;
  background: rgba(255,255,255,0.6);
  transform: translateX(-50%) rotate(-3deg);
}

/* ì‚­ì œ */
.postit:hover .delete {
  opacity: 1;
}
.delete {
  position: absolute;
  top: 6px;
  right: 8px;
  cursor: pointer;
  font-size: 18px;
  opacity: 0;
  transition: 0.2s;
}

/* ì¶”ê°€ ë²„íŠ¼ */
#openForm {
  position: fixed;
  right: 25px;
  bottom: 25px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;
  background: #ffeb3b;
  font-size: 28px;
  cursor: pointer;
  z-index: 10;
}

/* ëª¨ë‹¬ */
#overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  z-index: 20;
}
#formBox {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 340px;
  background: #fffdf7;
  padding: 20px;
  border-radius: 12px;
  display: none;
  z-index: 30;
}
#formBox textarea,
#formBox input,
#formBox select,
#formBox button {
  width: 100%;
  margin-top: 10px;
  padding: 8px;
}
</style>
</head>

<body>

<h1>ğŸŸ¨ í¬ìŠ¤íŠ¸ì‡ ë²½ ğŸŸ¨</h1>
<div id="board"></div>

<button id="openForm" onclick="openForm()">ï¼‹</button>

<div id="overlay" onclick="closeForm()"></div>

<div id="formBox">
  <h3>í¬ìŠ¤íŠ¸ì‡ ì‘ì„±</h3>
  <textarea id="textInput" placeholder="ê¸€ê·€ë¥¼ ì ì–´ì£¼ì„¸ìš”"></textarea>
  <input id="pwInput" maxlength="4" placeholder="4ìë¦¬ ìˆ«ì ë¹„ë°€ë²ˆí˜¸">
  <select id="colorSelect">
    <option value="#fff59d">ë…¸ë‘</option>
    <option value="#ffccbc">ì‚´êµ¬</option>
    <option value="#c8e6c9">ì—°ë‘</option>
    <option value="#bbdefb">í•˜ëŠ˜</option>
  </select>
  <button onclick="addPostit()">ë¶™ì´ê¸°</button>
</div>

<script>
const ADMIN_PW = "87524";
const board = document.getElementById("board");

let postits = JSON.parse(localStorage.getItem("postits")) || [];

/* ê²¹ì¹¨ ê²€ì‚¬ */
function isOverlapping(x, y, w, h) {
  return postits.some(p =>
    x < p.x + p.w &&
    x + w > p.x &&
    y < p.y + p.h &&
    y + h > p.y
  );
}

/* â˜… í˜„ì¬ ë³´ì´ëŠ” íŒ ì•ˆì—ì„œë§Œ ìœ„ì¹˜ ì°¾ê¸° */
function findPosition(w, h) {
  const maxX = board.clientWidth - w;
  const maxY = board.clientHeight - h;

  for (let i = 0; i < 200; i++) {
    const x = Math.random() * maxX;
    const y = Math.random() * maxY;
    if (!isOverlapping(x, y, w, h)) return { x, y };
  }
  return { x: 20, y: 20 };
}

/* íŒ ë†’ì´ ìë™ ì¡°ì ˆ */
function adjustBoardHeight() {
  if (postits.length === 0) {
    board.style.minHeight = "100vh";
    return;
  }

  let maxBottom = 0;
  postits.forEach(p => {
    const bottom = p.y + p.h;
    if (bottom > maxBottom) maxBottom = bottom;
  });

  board.style.minHeight = Math.max(window.innerHeight, maxBottom + 60) + "px";
}

/* ë Œë” */
function render() {
  board.innerHTML = "";

  postits.forEach((p, i) => {
    const el = document.createElement("div");
    el.className = "postit";
    el.style.left = p.x + "px";
    el.style.top = p.y + "px";
    el.style.backgroundColor = p.color;
    el.style.transform = `rotate(${p.rotate}deg)`;
    el.innerText = p.text;

    const del = document.createElement("div");
    del.className = "delete";
    del.innerText = "ğŸ—‘ï¸";
    del.onclick = () => deletePostit(i);

    el.appendChild(del);
    board.appendChild(el);

    p.w = el.offsetWidth;
    p.h = el.offsetHeight;
  });

  localStorage.setItem("postits", JSON.stringify(postits));
  adjustBoardHeight();
}

/* ì¶”ê°€ */
function addPostit() {
  const text = textInput.value.trim();
  const pw = pwInput.value.trim();
  if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
  if (!/^\d{4}$/.test(pw)) return alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ì 4ìë¦¬");

  const size = 220;
  const pos = findPosition(size, size);

  postits.push({
    text,
    color: colorSelect.value,
    pw,
    x: pos.x,
    y: pos.y,
    w: size,
    h: size,
    rotate: Math.random() * 10 - 5
  });

  closeForm();
  textInput.value = "";
  pwInput.value = "";
  render();
}

/* ì‚­ì œ */
function deletePostit(index) {
  const input = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
  if (input === postits[index].pw || input === ADMIN_PW) {
    postits.splice(index, 1);
    render();
  } else {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤");
  }
}

/* ëª¨ë‹¬ */
function openForm() {
  overlay.style.display = "block";
  formBox.style.display = "block";
}
function closeForm() {
  overlay.style.display = "none";
  formBox.style.display = "none";
}

render();
</script>

</body>
</html>